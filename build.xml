<?xml version="1.0" encoding="ISO-8859-1"?>
<project name="MXUnitTask" basedir="." default="runtestslocal">
	
	<mkdir dir="testresults"/>
	<mkdir dir="junithtml"/>
	<mkdir dir="xsl"/>
	
	<target name="full" depends="runtestsjenkins,copy" />

	<target name="runtestslocal" description="Make output directories and run the MXUnit task">
		<echo message="Executando testes locais"/>

		<taskdef name="mxunittask" classname="org.mxunit.ant.MXUnitAntTask"  classpath="ant/lib/mxunit-ant.jar" />
		<mxunittask server="127.0.0.1"
			defaultrunner="/mxunit-jenkins/tests/HttpAntRunner.cfc"
			port="8501"
			outputdir="testresults" 
			verbose="true"
 			haltonfailure="false"
   			haltonerror="false"
			failureproperty="testsfailed">
			
			<directory runner="/mxunit-jenkins/tests/HttpAntRunner.cfc"
			                     remoteMethod="run"
			                     path="C:\ColdFusion10\cfusion\wwwroot\mxunit-jenkins\tests"
			                     packageName="mxunit-jenkins.tests"
			                     componentPath="mxunit-jenkins.tests"
			                     recurse="false"
			                    />
		</mxunittask>
		<fail if="testsfailed" message="Existem testes com falhas"/>
	</target>
	
	<target name="runtestsjenkins" description="Make output directories and run the MXUnit task">
		<echo message="Executando testes com Jenkins"/>
		<taskdef name="mxunittask" classname="org.mxunit.ant.MXUnitAntTask"  classpath="ant/lib/mxunit-ant.jar" />
			<mxunittask server="testes"
				defaultrunner="/mxunit/tests/HttpAntRunner.cfc"
				port="80"
				outputdir="testresults" 
				verbose="true"
	 			haltonfailure="false"
	   			haltonerror="false"
				failureproperty="testsfailed">		
				
				
				<directory runner="/mxunit/tests/HttpAntRunner.cfc"
				                     remoteMethod="run"
				                     path="/var/lib/jenkins/jobs/mxunit-jenkins/workspace/mxunit-jenkins/tests"
				                     packageName="mxunit-jenkins.tests"
				                     componentPath="mxunit-jenkins.tests"
				                     recurse="false"
				                    />
			</mxunittask>
		<fail if="testsfailed" message="Existem testes com falhas"/>
	</target>
		
	<target name="copy">
		<echo>Publicando do job/workspace para o Server CF</echo>
		<copy todir="/opt/jrun4/servers/testes/cfusion.ear/cfusion.war/mxunit-jenkins/" overwrite="true">  
	        <fileset dir="/var/lib/jenkins/jobs/mxunit-jenkins/workspace/">
	        	<include name="**/**" />
	        </fileset>  
		</copy>
	</target>
</project>
